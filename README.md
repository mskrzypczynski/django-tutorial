# Django 1.11
## Documentation:
[Link to documentation](https://docs.djangoproject.com/en/1.11/intro/tutorial01/)

----

## Python:
[Python 3.7.16](https://www.python.org/downloads/release/python-3716/)

----
### Building Python3.7.16 from source on Ubuntu 22.04 LTS:

Instructions:
1. Update packages repositories
```bash
sudo apt-get update
```
2. Install dependencies for building
```bash
sudo apt install build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libsqlite3-dev libreadline-dev libffi-dev wget libbz2-dev
```
3. Download Python 3.7.16 and extract tarball
```bash
cd &&
wget https://www.python.org/ftp/python/3.7.16/Python-3.7.16.tgz &&
tar -xvf Python-3.7.16
```
4. Kompilacja
```bash
cd Python-3.7.16
./configure --enable-optimizations
make -j $(nproc)
#nproc - number of available procesors
sudo make install
```
5. Install pip packages
```bash
python3 -m pip install virtualenv
```
6. Create project folder and virtual env
```bash
mkdir project && cd project
python3 -m pip virtualenv venv
source ./venv/bin/activate
```
7. Install `django` and `djangorestframework` packages in virtual environment
```bash
python3 -m pip install django==1.11.17 djangorestframework=3.11
```


## Creating project
```bash
django-admin startproject mysite
```
This command creates Django `project`. `Project` is
    a Python package – i.e. a directory of code – that contains all the settings for an instance of Django. This would include database configuration, Django-specific options and application-specific settings.
### Created file tree
```zsh
mysite/
    manage.py
    mysite/
        __init__.py
        settings.py
        urls.py
        wsgi.py
```
Files description:

- outer `mysite/` is container for project and its name doesn't matter to Django, can be renamed.
- `manage.py` is a command-line utility that let us to interact with created Django project.
- `mysite/` directory is a Python package for project. Its name is the Python package name.

- `mysite/__init__.py` is an empty file which tells Python that directory should be considered a Python package.
- `mysite/settings.py`- Settings/configuration for this Django project.
- `mysite/urls.py` is file for the URL declarations. It's like a "table of contents" for django-powered site.
- `mysite/wsgi.py` is an entry point for WSGI-compatible web server to serve this project.

## Running the development server

```sh
python manage.py runserver [port]
```
if everything is okay output will be following:
```sh
Performing system checks...

System check identified no issues (0 silenced).

You have unapplied migrations; your app may not work properly until they are applied.
Run 'python manage.py migrate' to apply them.

March 04, 2020 - 15:50:53
Django version 1.11, using settings 'mysite.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
```

# Polls app
## What is an app?
App is a Web application that does something - e. g., a Weblog system, a database of public records or a simple poll app.

App can live enywhere on Python path.
## What is a project?
A project is a collection of configuration and apps for particular website. A project can contain multiple apps. An app can be in multiple projects.

## Creating app
```bash
python manage.py start apppolls
#or
django-admin startapp polls
```
Created `polls` directory tree looks like:
```bash
polls/
    __init__.py
    admin.py
    apps.py
    migrations/
        __init__.py
    models.py
    tests.py
    views.py
```


running makemigrations is telling django that some changes were made to models and that we would like to store changes as migrations
Migrations are how django stores changes to models - they are just files on disk
`polls/migrations/0001_initial.py`

This command will run the migrations and manage db schema automatically

```bash
python manage.py migrate polls 00001
```

This command will show what SQL code will run when running migration

```bash
python manage.py sqlmigrate polls 001
```
- output will vary depending on the database we are using
- table names are automatically generated by combining the name of the app and the lowercase name of the model (can be overriden)

- primary keys are added automatically (can be overriden)
- django appends "_id" to the foreign key field (can be overriden)

- database-specific field types  which vary in different databases are handled automatically , also field quoting is handled automatically

this command checks for any problems in project without making migrations or touching the database
`python manage.py check`

Running `python manage.py migrate` creates model tables in database. It takes all the migrations that haven'g been applied. Django tracks which ones are applied using a special table in database called django_migrations. Migrations are very powerful and let us change model over time as we develop project, without the need to delete database or tables or making new onews. It sepcialises in upgrading datababase live without losing data.

Three step quide to making model changes:
- Change model in `models.py`
- run `python manage.py makemigrations` to create migrations for these changes
- run `python manage.py migrate` to apply those changes to the database

The reason that there are separate command to make and apply migrations is because they will be commited to version control system and shipped with app. they are not only making development easier they are also useable by other developer and in production.

# playing with the api
```bash
python manage.py shell
```

manage.py sets the DJANGO_SETTINGS_MODULE environment variable which gives django the python import pat to project settings.py file

alternatively,
setup DJANGO_SETTINGS_MODULE env var to project.settings and start plain python shell, and setup Django:
```py
>>> import django
>>> django.setup()
```
python must be ran from same directory manage.py is in
```py
get all objects of Question class
>>> from polls.models import Question, Choice   # Import the model classes we just wrote.

# No questions are in the system yet.
>>> Question.objects.all()
<QuerySet []>

# Create a new Question.
# Support for time zones is enabled in the default settings file, so
# Django expects a datetime with tzinfo for pub_date. Use timezone.now()
# instead of datetime.datetime.now() and it will do the right thing.
>>> from django.utils import timezone
>>> q = Question(question_text="What's new?", pub_date=timezone.now())

# Save the object into the database. You have to call save() explicitly.
>>> q.save()

# Now it has an ID. Note that this might say "1L" instead of "1", depending
# on which database you're using. That's no biggie; it just means your
# database backend prefers to return integers as Python long integer
# objects.
>>> q.id
1

# Access model field values via Python attributes.
>>> q.question_text
"What's new?"
>>> q.pub_date
datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=<UTC>)

# Change values by changing the attributes, then calling save().
>>> q.question_text = "What's up?"
>>> q.save()

# objects.all() displays all the questions in the database.
>>> Question.objects.all()
<QuerySet [<Question: Question object>]>

```
